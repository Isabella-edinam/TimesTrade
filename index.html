<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>TIMESTRADE ‚Äî Your Personal Trading Bot</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#07090d; --panel:#0c1018; --border:#1c2535; --border2:#243044;
  --accent:#00e57a; --accent-dim:rgba(0,229,122,0.1);
  --accent2:#38b6ff; --accent2-dim:rgba(56,182,255,0.08);
  --warn:#ff7043; --red:#ff4757; --text:#cdd6e3;
  --dim:#48596e; --dim2:#2e3d52;
  --glow:0 0 24px rgba(0,229,122,0.22);
  --mono:'Space Mono',monospace; --sans:'DM Sans',sans-serif; --display:'Bebas Neue',sans-serif;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);font-size:14px;line-height:1.6;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(0,229,122,0.018) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,122,0.018) 1px,transparent 1px);
  background-size:44px 44px;}
::-webkit-scrollbar{width:3px;} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
#app{display:flex;flex-direction:column;height:100vh;position:relative;z-index:1;}
header{display:flex;align-items:center;justify-content:space-between;padding:0 20px;height:54px;flex-shrink:0;border-bottom:1px solid var(--border);background:rgba(12,16,24,0.97);backdrop-filter:blur(12px);z-index:20;}
.logo-wrap{display:flex;align-items:center;gap:10px;text-decoration:none;}
.back-btn{font-size:10px;font-family:var(--mono);color:var(--dim);border:1px solid var(--border);padding:4px 9px;border-radius:6px;transition:all .2s;white-space:nowrap;}
.logo-wrap:hover .back-btn{color:var(--text);border-color:var(--border2);}
.logo{font-family:var(--display);font-size:24px;letter-spacing:3px;color:var(--accent);text-shadow:var(--glow);}
.logo span{color:var(--accent2);}
.hdr-center{display:flex;align-items:center;gap:8px;}
.status-pill{display:flex;align-items:center;gap:6px;background:rgba(0,229,122,0.06);border:1px solid rgba(0,229,122,0.15);padding:4px 10px;border-radius:20px;font-family:var(--mono);font-size:10px;color:var(--accent);}
.dot{width:6px;height:6px;border-radius:50%;background:var(--accent);box-shadow:0 0 6px var(--accent);animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.msg-count{font-family:var(--mono);font-size:10px;color:var(--dim);background:rgba(255,255,255,0.03);border:1px solid var(--border);padding:4px 10px;border-radius:20px;}
.hdr-actions{display:flex;gap:6px;align-items:center;}
.hbtn{background:rgba(255,255,255,0.03);border:1px solid var(--border);color:var(--dim);cursor:pointer;padding:5px 11px;border-radius:8px;font-size:11px;font-family:var(--mono);transition:all .2s;}
.hbtn:hover{color:var(--text);border-color:var(--border2);}
.hbtn.red:hover{color:var(--red);border-color:rgba(255,71,87,.3);background:rgba(255,71,87,.05);}
.upgrade-hdr{background:linear-gradient(135deg,#f7971e,#ffd200);color:#000;font-family:var(--mono);font-size:10px;font-weight:700;padding:6px 13px;border-radius:20px;cursor:pointer;border:none;letter-spacing:.5px;transition:all .2s;text-decoration:none;white-space:nowrap;}
.upgrade-hdr:hover{transform:scale(1.05);box-shadow:0 0 18px rgba(255,210,0,0.4);}
.body{display:flex;flex:1;overflow:hidden;}
.sidebar{width:252px;flex-shrink:0;border-right:1px solid var(--border);background:var(--panel);display:flex;flex-direction:column;overflow:hidden;}
.tabs{display:flex;border-bottom:1px solid var(--border);flex-shrink:0;}
.tab{flex:1;padding:11px 4px;text-align:center;font-size:10px;font-family:var(--mono);cursor:pointer;color:var(--dim);border-bottom:2px solid transparent;transition:all .2s;text-transform:uppercase;letter-spacing:.8px;}
.tab.on{color:var(--accent);border-bottom-color:var(--accent);background:rgba(0,229,122,0.03);}
.tab:hover:not(.on){color:var(--text);}
.pane{display:none;flex:1;overflow-y:auto;padding:13px;flex-direction:column;gap:9px;}
.pane.on{display:flex;}
.sec{font-family:var(--mono);font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:2px;padding-bottom:6px;border-bottom:1px solid var(--border);flex-shrink:0;}
.hr{height:1px;background:var(--border);flex-shrink:0;}
.sbtn{background:rgba(255,255,255,0.02);border:1px solid var(--border);color:var(--text);padding:9px 11px;border-radius:9px;cursor:pointer;font-size:12px;text-align:left;transition:all .2s;font-family:var(--sans);width:100%;}
.sbtn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim);transform:translateX(3px);}
.sbtn .tag{display:block;font-size:10px;color:var(--dim);margin-top:2px;font-family:var(--mono);}
.lcard{background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:10px;padding:11px;cursor:pointer;transition:all .2s;}
.lcard:hover{border-color:var(--accent2);background:var(--accent2-dim);}
.lc-t{font-size:12px;font-weight:600;color:var(--accent2);margin-bottom:3px;display:flex;align-items:center;gap:5px;}
.lc-d{font-size:11px;color:var(--dim);line-height:1.5;}
.lvl{font-size:9px;font-family:var(--mono);padding:2px 6px;border-radius:10px;margin-left:auto;}
.lvl.b{background:rgba(0,229,122,0.1);color:var(--accent);}
.lvl.i{background:rgba(255,165,0,0.1);color:orange;}
.lvl.a{background:rgba(255,71,87,0.1);color:var(--red);}
.cfg-row{display:flex;flex-direction:column;gap:4px;}
.cfg-lbl{font-size:10px;color:var(--dim);font-family:var(--mono);text-transform:uppercase;letter-spacing:1px;}
.cfg-inp{background:rgba(255,255,255,0.03);border:1px solid var(--border);color:var(--text);padding:7px 10px;border-radius:7px;font-size:12px;font-family:var(--mono);outline:none;transition:border-color .2s;width:100%;}
.cfg-inp:focus{border-color:var(--accent);}
.chat{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
.msgs{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:18px;scroll-behavior:smooth;}
.welcome{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;text-align:center;gap:14px;padding:32px 20px;animation:fadeUp .5s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
.w-icon{font-size:52px;animation:float 3s ease-in-out infinite;filter:drop-shadow(0 0 18px rgba(0,229,122,.5));}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.welcome h1{font-family:var(--display);font-size:36px;letter-spacing:4px;color:var(--accent);text-shadow:var(--glow);}
.welcome p{color:var(--dim);font-size:13px;max-width:400px;line-height:1.75;}
.chips{display:flex;flex-wrap:wrap;gap:7px;justify-content:center;margin-top:4px;}
.chip{background:var(--accent-dim);border:1px solid rgba(0,229,122,.2);color:var(--accent);padding:6px 13px;border-radius:20px;font-size:12px;cursor:pointer;transition:all .2s;font-family:var(--sans);}
.chip:hover{background:rgba(0,229,122,.18);box-shadow:var(--glow);}
.msg{display:flex;gap:10px;animation:msgIn .28s ease;position:relative;}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.user{flex-direction:row-reverse;align-self:flex-end;max-width:80%;}
.msg.bot{max-width:92%;}
.mwrap{display:flex;flex-direction:column;gap:4px;min-width:0;}
.msg.user .mwrap{align-items:flex-end;}
.av{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:var(--display);font-size:12px;letter-spacing:1px;flex-shrink:0;margin-top:2px;}
.av.bot{background:linear-gradient(135deg,rgba(0,229,122,.18),rgba(56,182,255,.18));border:1px solid rgba(0,229,122,.25);color:var(--accent);}
.av.user{background:linear-gradient(135deg,rgba(255,112,67,.18),rgba(255,200,0,.15));border:1px solid rgba(255,112,67,.25);color:var(--warn);}
.bub{padding:11px 15px;border-radius:13px;font-size:13.5px;line-height:1.7;word-break:break-word;}
.msg.bot .bub{background:rgba(255,255,255,.035);border:1px solid var(--border);border-top-left-radius:2px;}
.msg.user .bub{background:rgba(0,229,122,.07);border:1px solid rgba(0,229,122,.18);border-top-right-radius:2px;color:#dde6f0;}
.delbtn{opacity:0;pointer-events:none;background:rgba(255,71,87,.1);border:1px solid rgba(255,71,87,.2);color:var(--red);width:24px;height:24px;border-radius:6px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;margin-top:4px;align-self:flex-start;}
.msg:hover .delbtn{opacity:1;pointer-events:all;}
.delbtn:hover{background:rgba(255,71,87,.22);transform:scale(1.1);}
.bub p{margin-bottom:8px;} .bub p:last-child{margin-bottom:0;}
.bub strong{color:var(--accent);font-weight:600;}
.bub em{color:var(--accent2);font-style:normal;font-weight:500;}
.bub h3{color:var(--accent);font-size:13px;margin:12px 0 5px;font-family:var(--mono);}
.bub ul,.bub ol{padding-left:17px;margin:7px 0;} .bub li{margin-bottom:4px;}
.bub blockquote{border-left:3px solid var(--accent);padding-left:11px;margin:8px 0;color:var(--dim);font-style:italic;}
.bub pre{background:#050810;border:1px solid var(--border2);border-radius:9px;padding:14px;overflow-x:auto;margin:10px 0;font-family:var(--mono);font-size:11px;line-height:1.75;color:#79c0ff;position:relative;}
.copybtn{position:absolute;top:8px;right:8px;background:rgba(0,229,122,.08);border:1px solid rgba(0,229,122,.25);color:var(--accent);padding:3px 9px;border-radius:5px;font-size:10px;cursor:pointer;font-family:var(--mono);transition:all .2s;}
.copybtn:hover{background:rgba(0,229,122,.18);}
.dlbtn{display:inline-flex;align-items:center;gap:5px;margin-top:8px;background:rgba(0,229,122,.07);border:1px solid rgba(0,229,122,.28);color:var(--accent);padding:6px 13px;border-radius:7px;font-size:11px;cursor:pointer;font-family:var(--mono);transition:all .2s;text-decoration:none;}
.dlbtn:hover{background:rgba(0,229,122,.14);box-shadow:var(--glow);}
.typing-dots{display:flex;gap:5px;align-items:center;padding:12px 15px;}
.typing-dots span{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:bounce 1.2s infinite;opacity:.7;}
.typing-dots span:nth-child(2){animation-delay:.2s} .typing-dots span:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}
.ibar{padding:12px 16px 14px;border-top:1px solid var(--border);background:rgba(12,16,24,.97);backdrop-filter:blur(12px);flex-shrink:0;}
.irow{display:flex;gap:8px;align-items:flex-end;}
.iwrap{flex:1;display:flex;gap:8px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:13px;padding:10px 14px;transition:border-color .2s,box-shadow .2s;}
.iwrap:focus-within{border-color:rgba(0,229,122,.38);box-shadow:0 0 0 3px rgba(0,229,122,.05);}
#inp{flex:1;background:none;border:none;outline:none;color:var(--text);font-size:13.5px;font-family:var(--sans);resize:none;min-height:22px;max-height:110px;line-height:1.55;}
#inp::placeholder{color:var(--dim);}
.sendbtn{background:var(--accent);border:none;color:#000;width:34px;height:34px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;transition:all .2s;align-self:flex-end;}
.sendbtn:hover{background:#00ff88;box-shadow:var(--glow);transform:scale(1.05);}
.sendbtn:disabled{background:var(--border);color:var(--dim);cursor:not-allowed;transform:none;box-shadow:none;}
.sbtoggle{background:rgba(255,255,255,.03);border:1px solid var(--border);color:var(--dim);width:34px;height:34px;border-radius:8px;cursor:pointer;display:none;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;transition:all .2s;align-self:flex-end;}
.sbtoggle:hover{color:var(--text);}
.ihint{font-size:10px;color:var(--dim2);font-family:var(--mono);margin-top:7px;text-align:center;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:300;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);padding:20px;}
.overlay.on{display:flex;animation:fadeIn .15s ease;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.cbox{background:var(--panel);border:1px solid var(--border2);border-radius:16px;padding:28px 30px;text-align:center;max-width:300px;width:100%;box-shadow:0 24px 60px rgba(0,0,0,.6);animation:popIn .2s cubic-bezier(.34,1.56,.64,1);}
@keyframes popIn{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
.cbox h3{font-family:var(--mono);color:var(--red);margin-bottom:9px;font-size:14px;}
.cbox p{color:var(--dim);font-size:13px;margin-bottom:20px;}
.cbtns{display:flex;gap:8px;justify-content:center;}
.cbtn-no{background:rgba(255,255,255,.04);border:1px solid var(--border);color:var(--text);padding:8px 18px;border-radius:8px;cursor:pointer;font-family:var(--mono);font-size:12px;transition:all .2s;}
.cbtn-no:hover{background:rgba(255,255,255,.08);}
.cbtn-yes{background:rgba(255,71,87,.14);border:1px solid rgba(255,71,87,.38);color:var(--red);padding:8px 18px;border-radius:8px;cursor:pointer;font-family:var(--mono);font-size:12px;transition:all .2s;}
.cbtn-yes:hover{background:rgba(255,71,87,.24);}
.toast{position:fixed;bottom:75px;left:50%;transform:translateX(-50%) translateY(16px);background:var(--panel);border:1px solid var(--border2);color:var(--text);padding:8px 18px;border-radius:20px;font-size:12px;font-family:var(--mono);z-index:400;opacity:0;transition:all .3s ease;pointer-events:none;white-space:nowrap;}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0);}

/* ‚îÄ‚îÄ PAYWALL MODAL ‚îÄ‚îÄ */
.paywall{position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:500;display:none;align-items:center;justify-content:center;backdrop-filter:blur(8px);padding:20px;}
.paywall.on{display:flex;animation:fadeIn .2s ease;}
.pw-box{background:var(--panel);border:1px solid rgba(255,210,0,0.3);border-radius:20px;padding:40px 36px;text-align:center;max-width:420px;width:100%;box-shadow:0 40px 80px rgba(0,0,0,0.7),0 0 0 1px rgba(255,210,0,0.05);position:relative;animation:popIn .3s cubic-bezier(.34,1.56,.64,1);}
.pw-glow{position:absolute;top:-60px;left:50%;transform:translateX(-50%);width:200px;height:200px;background:radial-gradient(circle,rgba(255,210,0,0.12) 0%,transparent 70%);pointer-events:none;}
.pw-icon{font-size:48px;margin-bottom:12px;filter:drop-shadow(0 0 16px rgba(255,210,0,0.5));}
.pw-box h2{font-family:var(--display);font-size:36px;letter-spacing:3px;color:#fff;margin-bottom:6px;}
.pw-box h2 span{color:#ffd200;}
.pw-price{font-family:var(--mono);font-size:13px;color:var(--dim);margin-bottom:20px;}
.pw-price strong{color:#ffd200;font-size:28px;}
.pw-features{text-align:left;margin:0 auto 28px;max-width:280px;display:flex;flex-direction:column;gap:9px;}
.pw-feat{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--text);}
.pw-feat::before{content:'‚úì';color:var(--accent);font-weight:700;font-family:var(--mono);flex-shrink:0;}
.pw-btn{display:block;width:100%;padding:15px;background:linear-gradient(135deg,#f7971e,#ffd200);color:#000;font-family:var(--mono);font-size:14px;font-weight:700;border:none;border-radius:11px;cursor:pointer;letter-spacing:.5px;transition:all .2s;text-decoration:none;margin-bottom:12px;}
.pw-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(255,210,0,0.4);}
.pw-skip{font-size:11px;color:var(--dim);font-family:var(--mono);cursor:pointer;transition:color .2s;background:none;border:none;}
.pw-skip:hover{color:var(--text);}
.pw-note{font-size:10px;color:var(--dim2);font-family:var(--mono);margin-top:14px;}

/* LIMIT BAR */
.limit-bar{display:flex;align-items:center;justify-content:center;gap:8px;padding:6px 16px;background:rgba(255,210,0,0.05);border-bottom:1px solid rgba(255,210,0,0.1);font-family:var(--mono);font-size:10px;color:#ffd200;}
.limit-dots{display:flex;gap:4px;}
.ldot{width:8px;height:8px;border-radius:50%;background:rgba(255,210,0,0.2);transition:all .3s;}
.ldot.used{background:#ffd200;box-shadow:0 0 6px rgba(255,210,0,0.5);}
.limit-bar a{color:var(--accent);text-decoration:none;margin-left:6px;}
.limit-bar a:hover{text-decoration:underline;}

@media(max-width:640px){
  .sidebar{position:absolute;left:0;top:54px;bottom:0;z-index:15;width:280px;transform:translateX(-100%);transition:transform .3s ease;border-right:1px solid var(--border2);}
  .sidebar.open{transform:translateX(0);}
  .sboverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:14;}
  .sboverlay.on{display:block;}
  .hdr-center{display:none;}
  .sbtoggle{display:flex;}
  .back-btn{display:none;}
  .msg.user{max-width:92%;}
  .msg.bot{max-width:100%;}
}
</style>
</head>
<body>
<div id="app">
  <header>
    <a class="logo-wrap" href="/">
      <span class="back-btn">‚Üê Home</span>
      <div class="logo">TIMES<span>TRADE</span></div>
    </a>
    <div class="hdr-center">
      <div class="status-pill"><div class="dot"></div>LIVE</div>
      <div class="msg-count" id="msgCount">0 messages</div>
    </div>
    <div class="hdr-actions">
      <button class="hbtn" onclick="exportChat()">üíæ Save</button>
      <button class="hbtn red" onclick="askClear()">üóë Clear</button>
      <a class="upgrade-hdr" href="https://buy.stripe.com/fZu7sNggR74q0sHf6TcMM01" target="_blank">‚ö° Pro ‚Äî $9/mo</a>
    </div>
  </header>

  <!-- Free limit bar -->
  <div class="limit-bar" id="limitBar">
    <span>FREE MESSAGES:</span>
    <div class="limit-dots" id="limitDots"></div>
    <span id="limitText">8 remaining</span>
    <a href="https://buy.stripe.com/fZu7sNggR74q0sHf6TcMM01" target="_blank">Upgrade for unlimited ‚Üí</a>
  </div>

  <div class="body">
    <div class="sidebar" id="sb">
      <div class="tabs">
        <div class="tab on" onclick="switchTab('bots')">‚ö° Bots</div>
        <div class="tab" onclick="switchTab('learn')">üìö Learn</div>
        <div class="tab" onclick="switchTab('cfg')">‚öôÔ∏è Config</div>
      </div>
      <div class="pane on" id="pane-bots">
        <div class="sec">Quick EA Generators</div>
        <button class="sbtn" onclick="qs('Create a full MA Crossover EA: buy when 50 SMA crosses above 200 SMA, sell when it crosses below. 2% risk, 50 pip SL, 100 pip TP')">üìà MA Crossover<span class="tag">50/200 ¬∑ Golden Cross</span></button>
        <button class="sbtn" onclick="qs('Create an RSI EA: buy when RSI < 30, sell when RSI > 70. 1.5% risk, 40 pip SL, 80 pip TP')">üìä RSI Strategy<span class="tag">30/70 Levels</span></button>
        <button class="sbtn" onclick="qs('Create a Bollinger Bands breakout EA: buy above upper band, sell below lower band. 2% risk, 60 pip SL, 120 pip TP')">„Ä∞Ô∏è Bollinger Bands<span class="tag">Breakout System</span></button>
        <button class="sbtn" onclick="qs('Create a MACD crossover EA: buy when MACD crosses above signal line, sell when below. 2% risk, 45 pip SL, 90 pip TP')">üîÄ MACD Crossover<span class="tag">Signal Line</span></button>
        <button class="sbtn" onclick="qs('Create a scalping EA using EMA 9 and EMA 21 on M5. 1% risk, 15 pip SL, 30 pip TP')">‚ö° EMA Scalper<span class="tag">M5 ¬∑ Fast Signals</span></button>
        <button class="sbtn" onclick="qs('Create a daily breakout EA: buy above daily high, sell below daily low. 2% risk, 70 pip SL, 140 pip TP')">üïØÔ∏è Price Action<span class="tag">Daily Breakout</span></button>
        <div class="hr"></div>
        <div class="sec">Modify Your EA</div>
        <button class="sbtn" onclick="qs('Add a trailing stop of 20 pips to my existing EA')">‚ûï Add Trailing Stop</button>
        <button class="sbtn" onclick="qs('Add a time filter: only trade between 08:00 and 17:00 server time')">‚è∞ Add Time Filter</button>
        <button class="sbtn" onclick="qs('Add Telegram alerts when a trade opens or closes')">üì± Telegram Alerts</button>
        <div class="hr"></div>
        <div class="sec">Ready to Trade?</div>
        <a href="https://one.exnessonelink.com/a/c_hk9gvsw0ez" target="_blank" class="sbtn" style="background:rgba(255,165,0,0.06);border-color:rgba(255,165,0,0.3);color:#ffb347;text-align:center;display:block;text-decoration:none;font-weight:600;">üè¶ Open Free Exness Account<span class="tag">Recommended broker ¬∑ Start trading your EAs</span></a>
      </div>
      <div class="pane" id="pane-learn">
        <div class="sec">Beginner</div>
        <div class="lcard" onclick="qs('Explain forex trading to a complete beginner. What is it, how does it work, how do I start safely?')"><div class="lc-t">üåç What is Forex?<span class="lvl b">Beginner</span></div><div class="lc-d">Complete intro to currency markets</div></div>
        <div class="lcard" onclick="qs('Explain pips, lots, leverage and margin to a beginner with simple examples and real numbers')"><div class="lc-t">üìê Pips, Lots & Leverage<span class="lvl b">Beginner</span></div><div class="lc-d">Core trading vocabulary explained simply</div></div>
        <div class="lcard" onclick="qs('Explain the 2% risk rule and how to calculate position size with practical step-by-step examples')"><div class="lc-t">üõ°Ô∏è Risk Management<span class="lvl b">Beginner</span></div><div class="lc-d">Protect your account from big losses</div></div>
        <div class="lcard" onclick="qs('Explain stop loss and take profit to a beginner. Why are they critical and how do I set them?')"><div class="lc-t">üéØ Stop Loss & Take Profit<span class="lvl b">Beginner</span></div><div class="lc-d">Locking in gains, cutting losses</div></div>
        <div class="lcard" onclick="qs('Teach me how to read candlestick charts. Explain the most important patterns with examples')"><div class="lc-t">üïØÔ∏è Reading Candlesticks<span class="lvl b">Beginner</span></div><div class="lc-d">Understanding price charts visually</div></div>
        <div class="lcard" onclick="qs('What are the best currency pairs for a beginner to trade and why? What should I avoid?')"><div class="lc-t">üí± Best Pairs to Trade<span class="lvl b">Beginner</span></div><div class="lc-d">Where to start in forex markets</div></div>
        <div class="hr"></div>
        <div class="sec">Intermediate</div>
        <div class="lcard" onclick="qs('Explain Moving Averages, RSI, MACD and Bollinger Bands. How is each used in real trading?')"><div class="lc-t">üìä Key Indicators<span class="lvl i">Intermediate</span></div><div class="lc-d">MA, RSI, MACD, Bollinger Bands</div></div>
        <div class="lcard" onclick="qs('Explain support and resistance levels. How do I identify and trade them effectively?')"><div class="lc-t">üìè Support & Resistance<span class="lvl i">Intermediate</span></div><div class="lc-d">Key price levels and how to trade them</div></div>
        <div class="lcard" onclick="qs('What is trend trading? How do I identify trends, enter them, and know when they are ending?')"><div class="lc-t">üìà Trend Trading<span class="lvl i">Intermediate</span></div><div class="lc-d">Trading with market momentum</div></div>
        <div class="hr"></div>
        <div class="sec">Advanced</div>
        <div class="lcard" onclick="qs('Explain algorithmic trading and backtesting in MT5. How do I properly test a strategy before going live?')"><div class="lc-t">ü§ñ Algo & Backtesting<span class="lvl a">Advanced</span></div><div class="lc-d">Testing strategies before real money</div></div>
        <div class="lcard" onclick="qs('Explain trading psychology: what emotional mistakes destroy traders and how to avoid them?')"><div class="lc-t">üß† Trading Psychology<span class="lvl a">Advanced</span></div><div class="lc-d">Mastering emotions while trading</div></div>
      </div>
      <div class="pane" id="pane-cfg">
        <div class="sec">Default Trade Settings</div>
        <div class="cfg-row"><label class="cfg-lbl">Risk %</label><input class="cfg-inp" id="cRisk" value="2.0" type="number" step="0.1" min="0.1" max="10"></div>
        <div class="cfg-row"><label class="cfg-lbl">Stop Loss (pips)</label><input class="cfg-inp" id="cSL" value="50" type="number"></div>
        <div class="cfg-row"><label class="cfg-lbl">Take Profit (pips)</label><input class="cfg-inp" id="cTP" value="100" type="number"></div>
        <div class="cfg-row"><label class="cfg-lbl">Timeframe</label>
          <select class="cfg-inp" id="cTF"><option>M1</option><option>M5</option><option>M15</option><option>M30</option><option selected>H1</option><option>H4</option><option>D1</option></select>
        </div>
        <div class="cfg-row"><label class="cfg-lbl">Experience Level</label>
          <select class="cfg-inp" id="cLvl"><option value="beginner">Beginner</option><option value="intermediate" selected>Intermediate</option><option value="advanced">Advanced</option></select>
        </div>
        <div class="hr"></div>
        <p style="font-size:11px;color:var(--dim);line-height:1.7;">Chat is saved in your browser tab. Use <strong style="color:var(--accent2)">üíæ Save</strong> to download a backup before closing.</p>
      </div>
    </div>

    <div class="sboverlay" id="sbOverlay" onclick="closeSB()"></div>

    <div class="chat">
      <div class="msgs" id="msgs">
        <div class="welcome" id="welcome">
          <div class="w-icon">ü§ñ</div>
          <h1>YOUR AI TRADING BOT</h1>
          <p>Generate MT5 Expert Advisors, learn trading from scratch, or ask any trading question. 8 free messages ‚Äî then upgrade to Pro.</p>
          <div class="chips">
            <button class="chip" onclick="qs('I am a complete beginner. Teach me forex trading step by step from zero')">üìö Teach me forex</button>
            <button class="chip" onclick="qs('Create a moving average crossover Expert Advisor for MT5')">ü§ñ Build an EA</button>
            <button class="chip" onclick="qs('Explain the 2% risk rule and how to calculate lot size')">üõ°Ô∏è Risk rules</button>
            <button class="chip" onclick="qs('What are the best currency pairs for beginners and why?')">üí± Best pairs</button>
          </div>
        </div>
      </div>
      <div class="ibar">
        <div class="irow">
          <button class="sbtoggle" onclick="toggleSB()">‚ò∞</button>
          <div class="iwrap">
            <textarea id="inp" rows="1" placeholder="Ask anything about trading or describe an EA strategy..."></textarea>
            <button class="sendbtn" id="sendBtn" onclick="send()">‚û§</button>
          </div>
        </div>
        <div class="ihint">Enter to send ¬∑ Shift+Enter for new line ¬∑ Hover a message to delete it</div>
      </div>
    </div>
  </div>
</div>

<!-- Confirm dialog -->
<div class="overlay" id="overlay">
  <div class="cbox">
    <h3 id="cTitle">CONFIRM</h3>
    <p id="cText">Are you sure?</p>
    <div class="cbtns">
      <button class="cbtn-no" onclick="closeOverlay()">Cancel</button>
      <button class="cbtn-yes" id="cOk">Confirm</button>
    </div>
  </div>
</div>

<!-- Paywall modal -->
<div class="paywall" id="paywall">
  <div class="pw-box">
    <div class="pw-glow"></div>
    <div class="pw-icon">‚ö°</div>
    <h2>UPGRADE TO <span>PRO</span></h2>
    <div class="pw-price">Only <strong>$9</strong> / month</div>
    <div class="pw-features">
      <div class="pw-feat">Unlimited AI messages ‚Äî no limits ever</div>
      <div class="pw-feat">Generate unlimited MT5 Expert Advisors</div>
      <div class="pw-feat">Full trading education library</div>
      <div class="pw-feat">Priority AI responses</div>
      <div class="pw-feat">Download all .mq5 files</div>
      <div class="pw-feat">Cancel anytime</div>
    </div>
    <a class="pw-btn" href="https://buy.stripe.com/fZu7sNggR74q0sHf6TcMM01" target="_blank">üöÄ Upgrade Now ‚Äî $9/month</a>
    <button class="pw-skip" onclick="closePaywall()">Maybe later ‚Äî I'll keep my limit</button>
    <div class="pw-note">Secure payment via Stripe ¬∑ Cancel anytime</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const FREE_LIMIT = 8;
const STRIPE_URL = 'https://buy.stripe.com/fZu7sNggR74q0sHf6TcMM01';

// ‚îÄ‚îÄ LOCAL DEV KEY ‚îÄ‚îÄ
// Only used when opening the file directly (file:// or localhost).
// On Vercel the proxy handles auth ‚Äî this key is never exposed publicly.
// Paste your Anthropic API key below for local testing:
const LOCAL_API_KEY = 'YOUR_ANTHROPIC_API_KEY_HERE';

let msgs = [];
let apiMsgs = [];
let nextId = 1;
let freeUsed = parseInt(sessionStorage.getItem('tt_used') || '0');

const SYSTEM = `You are TIMESTRADE, an elite AI trading assistant and educator specializing in MT5/MQL5 Expert Advisor development and forex trading education.

Adapt your communication style based on user experience level:
- Beginner: Use very simple language. Define every trading term you use. Use relatable analogies and real-number examples. Be encouraging and patient. Explain WHY before HOW.
- Intermediate: Balanced technical and plain language.
- Advanced: Technical, concise, professional quant-trader style.

Your core capabilities:
1. TEACH TRADING FROM SCRATCH ‚Äî forex basics, candlestick patterns, indicators (MA, RSI, MACD, BB), risk management, trading psychology, market sessions.
2. BUILD COMPLETE MT5/MQL5 EXPERT ADVISORS ‚Äî production-ready code that compiles and runs in MetaTrader 5.
3. STRATEGY ADVICE ‚Äî help design, refine, and backtest strategies.
4. ANSWER ANY TRADING QUESTION.

When generating MQL5 EA code, ALWAYS include:
- #property headers and #include <Trade\\Trade.mqh>
- OnInit(), OnDeinit(), OnTick() functions
- Dynamic lot sizing from risk % of account balance
- CTrade class for all orders
- Stop loss and take profit in points
- 4-digit vs 5-digit broker detection (pipSize)
- Magic number for trade identification
- New-bar detection to avoid re-triggering
- Clear comments throughout
- Installation instructions at the end

Format: Use **bold** for key terms. Use bullet points for lists. Wrap all code in triple backticks.`;

// ‚îÄ‚îÄ LIMIT BAR ‚îÄ‚îÄ
function updateLimitBar() {
  const remaining = Math.max(0, FREE_LIMIT - freeUsed);
  document.getElementById('limitText').textContent = remaining + ' remaining';
  const dots = document.getElementById('limitDots');
  dots.innerHTML = '';
  for (let i = 0; i < FREE_LIMIT; i++) {
    const d = document.createElement('div');
    d.className = 'ldot' + (i < freeUsed ? ' used' : '');
    dots.appendChild(d);
  }
}

// ‚îÄ‚îÄ SEND ‚îÄ‚îÄ
async function send(override) {
  const textarea = document.getElementById('inp');
  const text = (override || textarea.value).trim();
  if (!text) return;

  // Check free limit
  if (freeUsed >= FREE_LIMIT) {
    showPaywall();
    return;
  }

  document.getElementById('welcome')?.remove();
  addMsg('user', text);
  textarea.value = '';
  textarea.style.height = 'auto';
  apiMsgs.push({ role: 'user', content: text });

  // Increment usage
  freeUsed++;
  sessionStorage.setItem('tt_used', freeUsed);
  updateLimitBar();
  saveSession();

  const btn = document.getElementById('sendBtn');
  btn.disabled = true;
  const typId = showTyping();

  try {
    const risk = document.getElementById('cRisk').value;
    const sl   = document.getElementById('cSL').value;
    const tp   = document.getElementById('cTP').value;
    const tf   = document.getElementById('cTF').value;
    const lvl  = document.getElementById('cLvl').value;

    const systemWithCtx = SYSTEM + `\n\nUser profile ‚Äî Experience: ${lvl}. Default EA settings unless stated: Risk=${risk}%, SL=${sl} pips, TP=${tp} pips, Timeframe=${tf}.`;

    // Auto-detect: use proxy on Vercel, call Anthropic directly when running locally
    const isLocal = location.protocol === 'file:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    const endpoint = isLocal ? 'https://api.anthropic.com/v1/messages' : '/api/chat';
    const headers = { 'Content-Type': 'application/json' };
    if (isLocal) {
      headers['x-api-key'] = LOCAL_API_KEY;
      headers['anthropic-version'] = '2023-06-01';
      headers['anthropic-dangerous-direct-browser-access'] = 'true';
    }

    const res = await fetch(endpoint, {
      method: 'POST',
      headers,
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: systemWithCtx,
        messages: apiMsgs
      })
    });

    const data = await res.json();
    if (data.error) throw new Error(data.error.message);

    const reply = data.content.map(b => b.text || '').join('');
    removeTyping(typId);
    apiMsgs.push({ role: 'assistant', content: reply });
    addMsg('bot', reply);
    saveSession();

    // Show paywall after hitting limit
    if (freeUsed >= FREE_LIMIT) {
      setTimeout(() => showPaywall(), 1200);
    }

  } catch (err) {
    removeTyping(typId);
    addMsg('bot', `‚ö†Ô∏è Something went wrong: ${err.message}`);
  }

  btn.disabled = false;
}

// ‚îÄ‚îÄ ADD MESSAGE ‚îÄ‚îÄ
function addMsg(role, text, existingId) {
  const id = existingId || nextId++;
  if (!existingId) msgs.push({ id, role, text });
  updateCount();

  const container = document.getElementById('msgs');
  const wrap = document.createElement('div');
  wrap.className = `msg ${role}`;
  wrap.dataset.id = id;

  const del = document.createElement('button');
  del.className = 'delbtn';
  del.title = 'Delete';
  del.textContent = 'üóë';
  del.onclick = () => confirmDelete(id);

  const av = document.createElement('div');
  av.className = `av ${role}`;
  av.textContent = role === 'bot' ? 'AI' : 'YOU';

  const mwrap = document.createElement('div');
  mwrap.className = 'mwrap';

  const bub = document.createElement('div');
  bub.className = 'bub';
  bub.innerHTML = renderText(text);

  mwrap.appendChild(bub);
  wrap.appendChild(del);
  wrap.appendChild(av);
  wrap.appendChild(mwrap);
  container.appendChild(wrap);
  container.scrollTop = container.scrollHeight;

  bub.querySelectorAll('pre').forEach(pre => {
    const cp = document.createElement('button');
    cp.className = 'copybtn';
    cp.textContent = 'COPY';
    cp.onclick = () => {
      const code = pre.innerText.replace(/^(COPY|COPIED!)$/gm, '').trim();
      navigator.clipboard.writeText(code);
      cp.textContent = 'COPIED!';
      setTimeout(() => cp.textContent = 'COPY', 2000);
    };
    pre.appendChild(cp);

    if (/OnInit|#property|CTrade/.test(pre.textContent)) {
      const dl = document.createElement('a');
      dl.className = 'dlbtn';
      dl.textContent = '‚¨á Download .mq5';
      dl.href = '#';
      dl.onclick = e => {
        e.preventDefault();
        const code = pre.innerText.replace(/^(COPY|COPIED!)$/gm, '').trim();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([code], { type: 'text/plain' }));
        a.download = 'TimesTrade_EA.mq5';
        a.click();
      };
      pre.after(dl);

      // Affiliate banner after EA download
      const aff = document.createElement('a');
      aff.href = 'https://one.exnessonelink.com/a/c_hk9gvsw0ez';
      aff.target = '_blank';
      aff.style.cssText = 'display:flex;align-items:center;gap:10px;margin-top:10px;padding:10px 14px;background:rgba(255,165,0,0.06);border:1px solid rgba(255,165,0,0.2);border-radius:9px;text-decoration:none;transition:all .2s;';
      aff.onmouseover = function(){this.style.background='rgba(255,165,0,0.12)'};
      aff.onmouseout = function(){this.style.background='rgba(255,165,0,0.06)'};
      aff.innerHTML = '<span style="font-size:22px">üè¶</span><div><div style="font-size:12px;font-weight:600;color:#ffb347;font-family:var(--mono)">Ready to run this EA?</div><div style="font-size:11px;color:var(--dim)">Open a free Exness account ‚Äî our recommended broker partner</div></div><span style="margin-left:auto;font-size:11px;color:#ffb347;font-family:var(--mono);white-space:nowrap">Open Free ‚Üí</span>';
      dl.after(aff);
    }
  });
}

function renderText(t) {
  t = t.replace(/```[\w]*\n?([\s\S]*?)```/g, (_, c) => `<pre>${esc(c.trim())}</pre>`);
  t = t.replace(/^#{1,3} (.+)/gm, '<h3>$1</h3>');
  t = t.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  t = t.replace(/\*(.+?)\*/g, '<em>$1</em>');
  t = t.replace(/^> (.+)/gm, '<blockquote>$1</blockquote>');
  t = t.replace(/^[\-\*] (.+)/gm, '<li>$1</li>');
  t = t.replace(/(<li>[\s\S]+?<\/li>)/g, m => `<ul>${m}</ul>`);
  t = t.replace(/\n\n/g, '</p><p>');
  t = t.replace(/\n/g, '<br>');
  return `<p>${t}</p>`;
}
function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function showTyping() {
  const id = 'typ' + Date.now();
  const container = document.getElementById('msgs');
  const d = document.createElement('div');
  d.id = id; d.className = 'msg bot';
  d.innerHTML = `<div class="av bot">AI</div><div class="mwrap"><div class="bub"><div class="typing-dots"><span></span><span></span><span></span></div></div></div>`;
  container.appendChild(d);
  container.scrollTop = container.scrollHeight;
  return id;
}
function removeTyping(id) { document.getElementById(id)?.remove(); }

function confirmDelete(id) {
  showConfirm('DELETE MESSAGE?', 'Remove this message and clear it from AI memory.', () => {
    const el = document.querySelector(`.msg[data-id="${id}"]`);
    if (el) { el.style.transition='all .3s'; el.style.opacity='0'; el.style.transform='translateX(15px)'; setTimeout(()=>el.remove(),300); }
    msgs = msgs.filter(m => m.id !== id);
    rebuildApi();
    saveSession();
    updateCount();
    toast('Message deleted');
  });
}

function askClear() {
  if (!msgs.length) return;
  showConfirm('CLEAR ALL?', 'Delete the entire conversation.', () => {
    document.getElementById('msgs').innerHTML = '';
    msgs = []; apiMsgs = [];
    sessionStorage.removeItem('tt_session');
    updateCount();
    const w = document.createElement('div');
    w.className = 'welcome'; w.id = 'welcome';
    w.innerHTML = `<div class="w-icon">ü§ñ</div><h1>CHAT CLEARED</h1><p>Start fresh below or pick a topic from the sidebar.</p><div class="chips"><button class="chip" onclick="qs('Teach me forex from zero')">üìö Start learning</button><button class="chip" onclick="qs('Create a moving average crossover EA')">ü§ñ Build an EA</button></div>`;
    document.getElementById('msgs').appendChild(w);
    toast('Conversation cleared');
  });
}

function rebuildApi() {
  apiMsgs = msgs.map(m => ({ role: m.role === 'bot' ? 'assistant' : 'user', content: m.text }));
}

function saveSession() {
  try { sessionStorage.setItem('tt_session', JSON.stringify({ msgs, nextId })); } catch(e) {}
}

function restoreSession() {
  try {
    const raw = sessionStorage.getItem('tt_session');
    if (!raw) return;
    const { msgs: saved, nextId: nid } = JSON.parse(raw);
    if (!saved?.length) return;
    document.getElementById('welcome')?.remove();
    saved.forEach(m => addMsg(m.role, m.text, m.id));
    msgs = saved; nextId = nid || saved.length + 1;
    rebuildApi(); updateCount();
  } catch(e) {}
}

function exportChat() {
  if (!msgs.length) { toast('Nothing to save yet'); return; }
  const txt = msgs.map(m => `[${m.role.toUpperCase()}]\n${m.text}`).join('\n\n---\n\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([`TIMESTRADE Chat\n${'='.repeat(30)}\n\n${txt}`], { type: 'text/plain' }));
  a.download = `TimesTrade_${new Date().toISOString().slice(0,10)}.txt`;
  a.click();
  toast('Chat saved!');
}

function updateCount() {
  document.getElementById('msgCount').textContent = `${msgs.length} message${msgs.length !== 1 ? 's' : ''}`;
}

function qs(text) { send(text); closeSB(); }

function switchTab(name) {
  document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('on', ['bots','learn','cfg'][i] === name));
  document.querySelectorAll('.pane').forEach(p => p.classList.remove('on'));
  document.getElementById('pane-' + name).classList.add('on');
}

function toggleSB() { document.getElementById('sb').classList.toggle('open'); document.getElementById('sbOverlay').classList.toggle('on'); }
function closeSB() { document.getElementById('sb').classList.remove('open'); document.getElementById('sbOverlay').classList.remove('on'); }

function showConfirm(title, text, onOk) {
  document.getElementById('cTitle').textContent = title;
  document.getElementById('cText').textContent = text;
  document.getElementById('cOk').onclick = () => { closeOverlay(); onOk(); };
  document.getElementById('overlay').classList.add('on');
}
function closeOverlay() { document.getElementById('overlay').classList.remove('on'); }
document.getElementById('overlay').addEventListener('click', e => { if (e.target.id === 'overlay') closeOverlay(); });

// ‚îÄ‚îÄ PAYWALL ‚îÄ‚îÄ
function showPaywall() { document.getElementById('paywall').classList.add('on'); }
function closePaywall() { document.getElementById('paywall').classList.remove('on'); }
document.getElementById('paywall').addEventListener('click', e => { if (e.target.id === 'paywall') closePaywall(); });

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('on');
  setTimeout(() => t.classList.remove('on'), 2200);
}

document.getElementById('inp').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
});
document.getElementById('inp').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 110) + 'px';
});

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
updateLimitBar();
restoreSession();
</script>
</body>
</html>